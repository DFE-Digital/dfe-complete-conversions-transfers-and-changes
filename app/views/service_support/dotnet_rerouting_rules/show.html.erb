<% content_for :primary_navigation do %>
  <%= render partial: "shared/navigation/service_support_primary_navigation" %>
<% end %>
<% content_for :page_title do %>
  <%= page_title(t("service_support.dotnet_rerouting_rules.title")) %>
<% end %>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l">Rerouting patterns</h2>
    <p class="govuk-body">
      The following patterns are defined for rerouting to the .NET version of the service:
    </p>
    
    <% if @patterns.empty? %>
      <div class="govuk-warning-text">
        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">Warning</span>
          No patterns found. This is likely due to insufficient Azure permissions. 
          Check that the service principal has 'Microsoft.Cdn/profiles/ruleSets/rules/read' permission.
        </strong>
      </div>
    <% elsif Rails.env.development? && @patterns.include?("projects/team") %>
      <div class="govuk-inset-text">
        <strong>Development Mode:</strong> Using sample patterns for testing. 
        In production, patterns are fetched from Azure Front Door.
      </div>
    <% end %>
    
    <table class="govuk-table rerouting-patterns">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Pattern</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        <% @patterns.each do |pattern| %>
          <tr class="govuk-table__row rerouting-pattern">
            <td class="govuk-table__cell"><%= pattern %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <h2 class="govuk-heading-l">Application routes</h2>
    <p class="govuk-body">
      The effect of these patterns on the application's routes is shown:
    </p>
    <table class="govuk-table app-routes">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Route</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        <% @routes.each do |route| %>
          <tr class="govuk-table__row app-route">
            <td class="govuk-table__cell">
              <%= route.highlighted_route %>
              <% if Rails.env.development? %>
                <small style="color: #666;">
                  <% if route.match? %>
                    (matches: <%= route.matching_pattern %>)
                  <% else %>
                    (no match)
                  <% end %>
                </small>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
